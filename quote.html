<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>El King's Interior – Quote Generator</title>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Montserrat', sans-serif; }
    .bg-gold { background-color: #D4AF37; }
    .text-gold { color: #D4AF37; }
    .bg-black { background-color: #000; }
    .text-black { color: #000; }
    .quote th { background-color: #000; color: #fff; }
    .signature { border-top: 1px solid #000; width: 180px; height: 60px; }

    .canva-embed {
      position: relative;
      width: 100px;
      height: 100px;
      box-shadow: 0 2px 8px rgba(63,69,81,0.16);
      border-radius: 8px;
      overflow: hidden;
    }
    .canva-embed iframe {
      position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none;
    }

    #issuerSignatureCanvas {
      border: 1px dashed #ccc;
      border-radius: 8px;
      background: #f9f9f9;
      touch-action: none;
    }

    #qrCodeImg {
      width: 100px;
      height: 100px;
      margin: 0 auto;
    }

    @media (max-width: 768px) {
      .canva-embed { width: 80px; height: 80px; }
      #issuerSignatureCanvas { width: 100% !important; height: 120px !important; }
      #qrCodeImg { width: 80px; height: 80px; }
    }

    @media print {
      body * { visibility: hidden; }
      #quotePreview, #quotePreview * { visibility: visible; }
      #quotePreview { position: absolute; left: 0; top: 0; width: 100%; }
      .no-print { display: none !important; }
      .canva-embed { width: 80px; height: 80px; }
      .company-name { font-size: 1.5rem !important; }
      #issuerSignatureImg { max-height: 50px; }
      #qrCodeImg { width: 70px; height: 70px; }
    }
  </style>
</head>
<body class="bg-gray-50 min-h-screen">

<div class="container mx-auto px-4 py-8 max-w-4xl">

  <!-- Header -->
  <h1 class="text-3xl font-bold text-center mb-10 text-black">
    El King's Interior – Quote Generator
  </h1>

  <!-- ==== INPUT FORM ==== -->
  <section class="bg-white rounded-xl shadow-lg p-8 mb-10 border border-gray-200 no-print">

    <!-- Company Details -->
    <div class="mb-8">
      <h2 class="text-2xl font-semibold mb-6 flex items-center">
        <span class="w-2 h-8 bg-gold mr-3 rounded"></span> Company Details
      </h2>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <input id="companyName" type="text" value="El King's Interior" class="w-full px-4 py-2.5 border border-gray-300 rounded-md focus:ring-2 focus:ring-gold">
        <input id="companyAddress" type="text" value="No. 123, FHA, Lugbe, Abuja" class="w-full px-4 py-2.5 border border-gray-300 rounded-md focus:ring-2 focus:ring-gold">
        <input id="companyPhone" type="text" value="+234-810 148 6536" class="w-full px-4 py-2.5 border border-gray-300 rounded-md focus:ring-2 focus:ring-gold">
        <input id="companyEmail" type="text" value="info@elkingsinterior.com" class="w-full px-4 py-2.5 border border-gray-300 rounded-md focus:ring-2 focus:ring-gold">
      </div>
    </div>

    <!-- Client & Quote Info -->
    <div class="mb-8">
      <h2 class="text-2xl font-semibold mb-6 flex items-center">
        <span class="w-2 h-8 bg-gold mr-3 rounded"></span> Client & Quote Details
      </h2>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Client Name *</label>
          <input id="clientName" type="text" class="w-full px-4 py-2.5 border border-gray-300 rounded-md focus:ring-2 focus:ring-gold" required>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Phone</label>
          <input id="clientPhone" type="text" class="w-full px-4 py-2.5 border border-gray-300 rounded-md focus:ring-2 focus:ring-gold">
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Address</label>
          <input id="clientAddress" type="text" class="w-full px-4 py-2.5 border border-gray-300 rounded-md focus:ring-2 focus:ring-gold">
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Quote Date</label>
          <input id="quoteDate" type="date" class="w-full px-4 py-2.5 border border-gray-300 rounded-md focus:ring-2 focus:ring-gold">
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Quote No. (Auto)</label>
          <input id="quoteNo" type="text" class="w-full px-4 py-2.5 border border-gray-300 rounded-md bg-gray-100" readonly>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Valid Until</label>
          <input id="validUntil" type="date" class="w-full px-4 py-2.5 border border-gray-300 rounded-md focus:ring-2 focus:ring-gold">
        </div>
      </div>
    </div>

    <!-- Add Items -->
    <h3 class="text-lg font-semibold mb-4 flex items-center">
      <span class="w-2 h-6 bg-gold mr-3 rounded"></span> Add Item
    </h3>
    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
      <input id="description" type="text" placeholder="Description" class="px-4 py-2.5 border border-gray-300 rounded-md focus:ring-2 focus:ring-gold">
      <input id="quantity" type="number" min="1" placeholder="Qty" class="px-4 py-2.5 border border-gray-300 rounded-md focus:ring-2 focus:ring-gold">
      <input id="price" type="number" step="0.01" placeholder="Price (₦)" class="px-4 py-2.5 border border-gray-300 rounded-md focus:ring-2 focus:ring-gold">
      <button id="addItemBtn" class="bg-black text-white px-6 py-2.5 rounded-md hover:bg-gray-800 transition font-medium">Add</button>
    </div>

    <!-- Live Items Table -->
    <div class="overflow-x-auto mb-6">
      <table class="w-full text-sm text-left">
        <thead class="quote">
          <tr>
            <th class="px-4 py-2">NO.</th>
            <th class="px-4 py-2">ITEM</th>
            <th class="px-4 py-2 text-center">QTY</th>
            <th class="px-4 py-2 text-right">PRICE</th>
            <th class="px-4 py-2 text-right">TOTAL</th>
            <th class="px-4 py-2 text-center">ACTION</th>
          </tr>
        </thead>
        <tbody id="itemsTableBody"></tbody>
      </table>
    </div>

    <!-- Tax & Discount -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Tax (VAT %)</label>
        <input id="taxRate" type="number" step="0.01" value="7.5" class="w-full px-4 py-2.5 border border-gray-300 rounded-md focus:ring-2 focus:ring-gold">
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Discount</label>
        <div class="flex gap-2">
          <input id="discountAmount" type="number" step="0.01" placeholder="0.00" class="flex-1 px-4 py-2.5 border border-gray-300 rounded-md focus:ring-2 focus:ring-gold">
          <select id="discountType" class="px-4 py-2.5 border border-gray-300 rounded-md focus:ring-2 focus:ring-gold">
            <option value="amount">₦</option>
            <option value="percent">%</option>
          </select>
        </div>
      </div>
    </div>

    <!-- Totals -->
    <div class="text-right space-y-2 mb-6 font-medium">
      <p>Subtotal: <span id="subtotal">₦ 0.00</span></p>
      <p>Tax (<span id="taxLabel">7.5</span>%): <span id="totalTax">₦ 0.00</span></p>
      <p>Discount: <span id="discountDisplay">₦ 0.00</span></p>
      <p class="text-xl font-bold text-black">TOTAL QUOTE: <span id="grandTotal">₦ 0.00</span></p>
    </div>

    <!-- Notes & Validity -->
    <div class="mb-6">
      <label class="block text-sm font-medium text-gray-700 mb-2">Notes</label>
      <textarea id="notes" rows="3" class="w-full px-4 py-2.5 border border-gray-300 rounded-md focus:ring-2 focus:ring-gold" placeholder="e.g. Quote valid for 30 days."></textarea>
    </div>

    <!-- Issuer Signature -->
    <div class="mt-8 p-4 bg-gray-50 rounded-lg border">
      <h3 class="font-semibold text-gold mb-3">Issuer Signature (Philip Odeh Anyebe)</h3>
      <canvas id="issuerSignatureCanvas" width="300" height="100" class="w-full h-32 border border-dashed border-gray-400 rounded-lg"></canvas>
      <button id="clearIssuerSignature" class="text-xs text-red-600 mt-2">Clear Signature</button>
    </div>
  </section>

  <!-- Generate Button -->
  <div class="text-center mb-8 no-print">
    <button id="generateBtn" class="bg-gold text-black px-10 py-4 rounded-md font-bold text-xl hover:bg-yellow-600 transition shadow-lg">
      Generate Quote
    </button>
  </div>

  <!-- ==== QUOTE PREVIEW ==== -->
  <section id="quotePreview" class="hidden bg-white rounded-xl shadow-xl max-w-3xl mx-auto print-area">
    <!-- Header -->
    <div class="flex justify-between items-center border-b-2 border-black pb-4 mb-6">
      <div class="canva-embed">
        <iframe loading="lazy" src="https://www.canva.com/design/DAGwxTnRu_4/lRDyVdipflri6jNyCfg9Xw/view?embed" allowfullscreen allow="fullscreen"></iframe>
      </div>
      <div class="flex-1 text-center">
        <h1 class="company-name text-3xl md:text-4xl font-bold text-gold tracking-wider">EL KING'S INTERIOR</h1>
        <p class="text-sm text-gray-600 mt-1">— MODERNISING SPACE —</p>
      </div>
      <div class="w-24"></div>
    </div>

    <!-- Company Info -->
    <div class="text-center text-xs text-gray-600 mb-6">
      <p id="prevCompanyAddress"></p>
      <p id="prevCompanyPhone"></p>
      <p id="prevCompanyEmail"></p>
    </div>

    <!-- Quote Info -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 text-sm mb-6">
      <div>
        <p><strong>Quote No:</strong> <span id="prevQuoteNo"></span></p>
        <p><strong>Date:</strong> <span id="prevQuoteDate"></span></p>
        <p><strong>Valid Until:</strong> <span id="prevValidUntil"></span></p>
      </div>
      <div>
        <p><strong>Client:</strong> <span id="prevClientName"></span></p>
        <p id="prevClientPhone"></p>
        <p id="prevClientAddress"></p>
      </div>
    </div>

    <!-- Items Table -->
    <table class="w-full text-sm mb-6">
      <thead>
        <tr class="quote">
          <th class="px-4 py-2 text-left">NO.</th>
          <th class="px-4 py-2 text-left">ITEM</th>
          <th class="px-4 py-2 text-center">QTY</th>
          <th class="px-4 py-2 text-right">PRICE</th>
          <th class="px-4 py-2 text-right">TOTAL</th>
        </tr>
      </thead>
      <tbody id="prevTableBody" class="divide-y divide-gray-300"></tbody>
    </table>

    <!-- Totals -->
    <div class="text-right space-y-1 mb-8 font-medium">
      <p>Subtotal: <span id="prevSubtotal"></span></p>
      <p>Tax (<span id="prevTaxRate"></span>%): <span id="prevTotalTax"></span></p>
      <p>Discount: <span id="prevDiscount"></span></p>
      <p class="text-xl font-bold text-black">TOTAL QUOTE: <span id="prevGrandTotal"></span></p>
    </div>

    <!-- Notes -->
    <div class="text-sm mb-6">
      <p class="font-semibold">Notes:</p>
      <p id="prevNotes" class="text-gray-700"></p>
    </div>

    <!-- QR Code -->
    <div class="flex justify-center mb-8">
      <div class="text-center">
        <p class="text-xs font-medium text-gray-600">Scan to Verify Quote</p>
        <img id="qrCodeImg" src="" alt="QR Code" class="mt-2">
      </div>
    </div>

    <!-- Signatures -->
    <div class="flex justify-between items-end mb-8">
      <div>
        <p class="text-xs">Accepted by:</p>
        <div class="signature mt-1"></div>
        <p class="text-xs font-medium">Client Signature</p>
      </div>
      <div class="text-right">
        <p class="text-xs font-medium">Prepared by:</p>
        <p class="text-sm font-bold">Philip Odeh Anyebe</p>
        <img id="issuerSignatureImg" src="" alt="Signature" class="hidden max-w-full h-auto mt-1">
      </div>
    </div>

    <!-- Footer -->
    <div class="pt-4 border-t border-gray-300 text-center text-xs text-gray-500">
      <p>kingsspacedesigns.netlify.app</p>
    </div>
  </section>

  <!-- Action Buttons -->
  <div id="actionButtons" class="hidden flex flex-wrap justify-center gap-4 mt-8 no-print">
    <button id="printBtn" class="bg-black text-white px-8 py-3.5 rounded-md font-bold text-lg hover:bg-gray-800 transition shadow-lg">
      Print / Save as PDF
    </button>
    <button id="emailBtn" class="bg-gold text-black px-8 py-3.5 rounded-md font-bold text-lg hover:bg-yellow-600 transition shadow-lg">
      Email Quote
    </button>
  </div>
</div>

<script>
  // Auto Quote No.
  const getNextQuoteNo = () => {
    const year = new Date().getFullYear();
    const key = `lastQuoteNo_${year}`;
    const last = parseInt(localStorage.getItem(key) || '0');
    const next = last + 1;
    localStorage.setItem(key, next);
    return `QOT-${year}-${String(next).padStart(3, '0')}`;
  };

  // Initialize
  document.getElementById('quoteDate').valueAsDate = new Date();
  document.getElementById('validUntil').valueAsDate = new Date(Date.now() + 30 * 24 * 60 * 60 * 1000); // 30 days
  document.getElementById('quoteNo').value = getNextQuoteNo();

  const items = [];
  let serialNo = 1;

  const formatCurrency = n => '₦ ' + parseFloat(n).toFixed(2).replace(/\d(?=(\d{3})+\.)/g, '$&,');

  // Signature Canvas
  const canvas = document.getElementById('issuerSignatureCanvas');
  const ctx = canvas.getContext('2d');
  let drawing = false;

  const startDraw = e => {
    drawing = true;
    ctx.beginPath();
    const rect = canvas.getBoundingClientRect();
    const x = (e.clientX || e.touches[0].clientX) - rect.left;
    const y = (e.clientY || e.touches[0].clientY) - rect.top;
    ctx.moveTo(x, y);
  };

  const draw = e => {
    if (!drawing) return;
    const rect = canvas.getBoundingClientRect();
    const x = (e.clientX || e.touches[0].clientX) - rect.left;
    const y = (e.clientY || e.touches[0].clientY) - rect.top;
    ctx.lineTo(x, y);
    ctx.stroke();
  };

  const stopDraw = () => { drawing = false; };

  canvas.addEventListener('mousedown', startDraw);
  canvas.addEventListener('mousemove', draw);
  canvas.addEventListener('mouseup', stopDraw);
  canvas.addEventListener('mouseout', stopDraw);
  canvas.addEventListener('touchstart', startDraw);
  canvas.addEventListener('touchmove', draw);
  canvas.addEventListener('touchend', stopDraw);

  document.getElementById('clearIssuerSignature').addEventListener('click', () => {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
  });

  // Add Item
  document.getElementById('addItemBtn').addEventListener('click', () => {
    const desc = document.getElementById('description').value.trim();
    const qty = +document.getElementById('quantity').value;
    const price = +document.getElementById('price').value;

    if (!desc || qty <= 0 || price <= 0) {
      alert('Please fill description, quantity, and price.');
      return;
    }

    items.push({ serialNo: serialNo++, desc, qty, price, total: qty * price });
    updateTable();
    clearItemInputs();
  });

  const clearItemInputs = () => {
    document.getElementById('description').value = '';
    document.getElementById('quantity').value = '';
    document.getElementById('price').value = '';
  };

  const updateTable = () => {
    const tbody = document.getElementById('itemsTableBody');
    tbody.innerHTML = '';
    let subtotal = 0;

    items.forEach((it, i) => {
      subtotal += it.total;
      const tr = document.createElement('tr');
      tr.className = 'hover:bg-gray-50';
      tr.innerHTML = `
        <td class="px-4 py-2">${it.serialNo}</td>
        <td class="px-4 py-2">${it.desc}</td>
        <td class="px-4 py-2 text-center">${it.qty}</td>
        <td class="px-4 py-2 text-right">${formatCurrency(it.price)}</td>
        <td class="px-4 py-2 text-right font-medium">${formatCurrency(it.total)}</td>
        <td class="px-4 py-2 text-center">
          <button onclick="removeItem(${i})" class="text-red-600 hover:text-red-800 text-xs">Remove</button>
        </td>`;
      tbody.appendChild(tr);
    });

    const taxRate = +document.getElementById('taxRate').value || 0;
    const tax = subtotal * (taxRate / 100);
    const discountAmt = +document.getElementById('discountAmount').value || 0;
    const discountType = document.getElementById('discountType').value;
    const discount = discountType === 'percent' ? subtotal * (discountAmt / 100) : discountAmt;
    const grand = subtotal + tax - discount;

    document.getElementById('subtotal').textContent = formatCurrency(subtotal);
    document.getElementById('taxLabel').textContent = taxRate;
    document.getElementById('totalTax').textContent = formatCurrency(tax);
    document.getElementById('discountDisplay').textContent = formatCurrency(discount);
    document.getElementById('grandTotal').textContent = formatCurrency(grand);
  };

  window.removeItem = idx => {
    items.splice(idx, 1);
    items.forEach((it, i) => it.serialNo = i + 1);
    serialNo = items.length + 1;
    updateTable();
  };

  ['taxRate', 'discountAmount', 'discountType'].forEach(id =>
    document.getElementById(id).addEventListener('input', updateTable)
  );

  // Generate Quote
  document.getElementById('generateBtn').addEventListener('click', () => {
    if (items.length === 0) return alert('Add at least one item.');
    if (!document.getElementById('clientName').value.trim()) return alert('Client name is required.');

    const hasSignature = canvas.getContext('2d').getImageData(0, 0, canvas.width, canvas.height).data.some(channel => channel !== 0);
    if (!hasSignature) return alert('Please sign as Philip Odeh Anyebe.');

    const company = {
      address: document.getElementById('companyAddress').value,
      phone: document.getElementById('companyPhone').value,
      email: document.getElementById('companyEmail').value
    };

    const client = {
      name: document.getElementById('clientName').value.trim(),
      phone: document.getElementById('clientPhone').value.trim() || 'N/A',
      address: document.getElementById('clientAddress').value.trim() || 'N/A'
    };

    const qDate = new Date(document.getElementById('quoteDate').value);
    const vUntil = new Date(document.getElementById('validUntil').value);
    const qNo = document.getElementById('quoteNo').value;

    const fmtQ = qDate.toLocaleDateString('en-GB', { day: 'numeric', month: 'long', year: 'numeric' });
    const fmtV = vUntil.toLocaleDateString('en-GB', { day: 'numeric', month: 'long', year: 'numeric' });

    const subtotal = items.reduce((s, it) => s + it.total, 0);
    const taxRate = +document.getElementById('taxRate').value || 0;
    const tax = subtotal * (taxRate / 100);
    const discountAmt = +document.getElementById('discountAmount').value || 0;
    const discountType = document.getElementById('discountType').value;
    const discount = discountType === 'percent' ? subtotal * (discountAmt / 100) : discountAmt;
    const grandTotal = subtotal + tax - discount;

    const notes = document.getElementById('notes').value || 'Quote valid until specified date.';

    // QR Code
    const qrData = {
      quote_no: qNo,
      date: fmtQ,
      valid_until: fmtV,
      client: client.name,
      total: formatCurrency(grandTotal),
      issuer: "Philip Odeh Anyebe"
    };
    document.getElementById('qrCodeImg').src = `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(JSON.stringify(qrData, null, 2))}`;

    // Fill Preview
    document.getElementById('prevCompanyAddress').textContent = company.address;
    document.getElementById('prevCompanyPhone').textContent = company.phone;
    document.getElementById('prevCompanyEmail').textContent = company.email;

    document.getElementById('prevQuoteNo').textContent = qNo;
    document.getElementById('prevQuoteDate').textContent = fmtQ;
    document.getElementById('prevValidUntil').textContent = fmtV;
    document.getElementById('prevClientName').textContent = client.name;
    document.getElementById('prevClientPhone').textContent = client.phone !== 'N/A' ? client.phone : '';
    document.getElementById('prevClientAddress').textContent = client.address;

    const tbody = document.getElementById('prevTableBody');
    tbody.innerHTML = '';
    items.forEach(it => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td class="px-4 py-2">${it.serialNo}</td>
        <td class="px-4 py-2">${it.desc}</td>
        <td class="px-4 py-2 text-center">${it.qty}</td>
        <td class="px-4 py-2 text-right">${formatCurrency(it.price)}</td>
        <td class="px-4 py-2 text-right font-medium">${formatCurrency(it.total)}</td>`;
      tbody.appendChild(tr);
    });

    document.getElementById('prevSubtotal').textContent = formatCurrency(subtotal);
    document.getElementById('prevTaxRate').textContent = taxRate;
    document.getElementById('prevTotalTax').textContent = formatCurrency(tax);
    document.getElementById('prevDiscount').textContent = formatCurrency(discount);
    document.getElementById('prevGrandTotal').textContent = formatCurrency(grandTotal);
    document.getElementById('prevNotes').textContent = notes;

    const sigImg = document.getElementById('issuerSignatureImg');
    sigImg.src = canvas.toDataURL();
    sigImg.classList.remove('hidden');

    // Show
    document.getElementById('quotePreview').classList.remove('hidden');
    document.getElementById('actionButtons').classList.remove('hidden');
    document.getElementById('generateBtn').classList.add('hidden');
  });

  // Print & Email
  document.getElementById('printBtn').addEventListener('click', () => window.print());

  document.getElementById('emailBtn').addEventListener('click', () => {
    const subject = `Quote ${document.getElementById('prevQuoteNo').textContent} - El King's Interior`;
    const body = document.getElementById('quotePreview').innerHTML;
    const mailto = `mailto:?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(
      `<html><head><style>body{font-family:Montserrat,sans-serif;}</style></head><body>${body}</body></html>`
    )}`;
    window.location.href = mailto;
  });
</script>
</body>
</html>