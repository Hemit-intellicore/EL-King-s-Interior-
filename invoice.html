<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>El King's Interior – Invoice Generator</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800&display=swap" rel="stylesheet">

  <style>
    body { font-family: 'Montserrat', sans-serif; background: #f9fafb; color: #1f2937; min-height: 100vh; }
    .input-card { @apply bg-white rounded-2xl shadow-xl p-6 md:p-8 border border-gray-200; }
    .input-field { @apply w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-yellow-400 focus:outline-none transition text-sm; }
    .btn-gold { @apply bg-gradient-to-r from-yellow-400 to-yellow-500 text-black font-bold px-6 py-3 rounded-full hover:from-yellow-500 hover:to-yellow-600 transition transform hover:scale-105 shadow-xl flex items-center justify-center gap-2; }
    .btn-generate { @apply bg-gradient-to-r from-yellow-500 to-yellow-600 text-black font-bold px-12 py-5 rounded-full text-xl hover:from-yellow-600 hover:to-yellow-700 transition transform hover:scale-110 shadow-2xl; }

    #invoicePreview { max-width: 800px; margin: 2rem auto; background: white; border-radius: 1rem; overflow: hidden; box-shadow: 0 20px 50px rgba(0,0,0,0.3); font-size: 0.875rem; line-height: 1.5; }
    .invoice-header { background: #000; color: #D4AF37; padding: 1.5rem 2rem; display: flex; align-items: center; justify-content: space-between; border-bottom: 4px solid #D4AF37; }
    .invoice-logo { width: 80px; height: 80px; object-fit: contain; filter: drop-shadow(0 0 8px rgba(212,175,55,0.5)); }
    .invoice-title { font-size: 2.2rem; font-weight: 800; letter-spacing: 0.12em; text-align: center; flex: 1; margin: 0 1rem; text-shadow: 0 2px 6px rgba(0,0,0,0.5); }
    .invoice-subtitle { font-size: 0.8rem; color: #cccccc; text-align: center; margin-top: 0.25rem; }
    .invoice-contact { text-align: center; font-size: 0.7rem; color: #666; margin: 1rem 0; }
    .invoice-body { padding: 1.5rem 2rem; }
    .invoice-info { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem; font-size: 0.8rem; }
    .invoice-info strong { color: #D4AF37; }
    .invoice-table { width: 100%; border-collapse: collapse; margin: 1rem 0; font-size: 0.8rem; }
    .invoice-table th { background: #000; color: #D4AF37; text-transform: uppercase; font-size: 0.7rem; padding: 0.5rem 0.75rem; text-align: left; }
    .invoice-table td { padding: 0.5rem 0.75rem; border-bottom: 1px solid #ddd; }
    .invoice-table .text-right { text-align: right; }
    .invoice-total, .invoice-tax, .invoice-discount { text-align: right; font-size: 1.1rem; font-weight: 700; color: #D4AF37; padding: 0.4rem 0; }
    .invoice-grand-total { text-align: right; font-size: 1.35rem; font-weight: 800; color: #D4AF37; padding-top: 0.75rem; border-top: 3px double #D4AF37; margin-top: 1rem; }
    .qr-container { text-align: center; margin: 1.5rem 0; }
    #qrCodeImg { width: 80px; height: 80px; margin: 0 auto; display: block; border: 3px solid #D4AF37; border-radius: 8px; padding: 3px; background: white; }
    .invoice-notes { margin: 1.5rem 0; font-size: 0.75rem; color: #555; font-style: italic; }
    .signature-area { display: flex; justify-content: space-between; align-items: flex-end; margin-top: 1.5rem; font-size: 0.7rem; }
    .signature-line { border-top: 2px solid #D4AF37; width: 160px; height: 40px; margin-top: 0.5rem; }
    .footer { text-align: center; padding: 1rem; background: #000; color: #666; font-size: 0.65rem; margin-top: 1.5rem; }

    #issuerSignatureCanvas {
      touch-action: none !important;
      -webkit-user-select: none;
      user-select: none;
      overscroll-behavior: contain;
    }

    @media print {
      @page { margin: 0.5cm; }
      body, html { margin: 0; padding: 0; background: white; }
      .no-print, #generateBtn, #actionButtons { display: none !important; }
      #invoicePreview { margin: 0 !important; box-shadow: none !important; border-radius: 0 !important; page-break-after: avoid; max-width: none; font-size: 10pt; }
      .invoice-header { padding: 1rem; }
      .invoice-body { padding: 1rem; }
      .invoice-title { font-size: 1.8rem; }
      .invoice-logo { width: 60px; height: 60px; }
      #qrCodeImg { width: 60px; height: 60px; }
    }
  </style>
</head>
<body class="p-4 md:p-8">

<div class="container max-w-4xl mx-auto">
  <h1 class="text-3xl font-bold text-center mb-10 text-gray-800 no-print">El King's Interior – Invoice Generator</h1>

  <section class="input-card mb-10 no-print">
    <h2 class="text-2xl font-semibold mb-6 text-gray-800 flex items-center">
      <span class="w-2 h-8 bg-yellow-400 mr-3 rounded"></span> Customer & Invoice Details
    </h2>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
      <input id="customerName" type="text" placeholder="Customer Name *" class="input-field" required>
      <input id="customerPhone" type="text" placeholder="Phone Number" class="input-field">
      <input id="customerAddress" type="text" placeholder="Address" class="input-field">
      <input id="invoiceDate" type="date" class="input-field">
      <input id="invoiceNo" type="text" class="input-field bg-gray-100 font-mono" readonly>
      <input id="dueDate" type="date" placeholder="Due Date" class="input-field">
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
      <div><label class="block text-sm font-medium text-gray-700 mb-1">Tax (%)</label><input id="taxPercent" type="number" min="0" step="0.01" value="0" class="input-field"></div>
      <div><label class="block text-sm font-medium text-gray-700 mb-1">Discount (%)</label><input id="discountPercent" type="number" min="0" step="0.01" value="0" class="input-field"></div>
    </div>

    <h3 class="text-lg font-semibold mb-4 text-gray-800 flex items-center">
      <span class="w-2 h-6 bg-yellow-400 mr-3 rounded"></span> Add Item
    </h3>

    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
      <input id="description" type="text" placeholder="Description" class="input-field">
      <input id="quantity" type="number" min="1" placeholder="Qty" class="input-field">
      <input id="price" type="number" step="0.01" placeholder="Price (₦)" class="input-field">
      <button id="addItemBtn" class="btn-gold">Add Item</button>
    </div>

    <div class="overflow-x-auto mb-6">
      <table class="w-full text-sm text-left border">
        <thead class="bg-gray-800 text-white">
          <tr><th class="px-4 py-2">NO.</th><th class="px-4 py-2">ITEM</th><th class="px-4 py-2 text-center">QTY</th><th class="px-4 py-2 text-right">PRICE</th><th class="px-4 py-2 text-right">TOTAL</th><th class="px-4 py-2 text-center">ACTION</th></tr>
        </thead>
        <tbody id="itemsTableBody" class="divide-y"></tbody>
      </table>
    </div>

    <div class="text-right space-y-1 mb-6">
      <p class="text-sm text-gray-600">Subtotal: <span id="subtotal">₦ 0.00</span></p>
      <p class="text-sm text-green-600">+ Tax (<span id="taxRate">0</span>%): <span id="taxAmount">₦ 0.00</span></p>
      <p class="text-sm text-red-600">- Discount (<span id="discountRate">0</span>%): <span id="discountAmount">₦ 0.00</span></p>
      <p class="text-xl font-bold text-gray-800">Grand Total: <span id="grandTotal">₦ 0.00</span></p>
    </div>

    <div class="p-5 bg-gray-50 rounded-xl border">
      <h3 class="font-semibold text-yellow-600 mb-3">Issuer Signature (Philip Odeh Anyebe)</h3>
      <canvas id="issuerSignatureCanvas" width="400" height="100" 
        class="w-full h-28 border-2 border-dashed border-gray-400 rounded-lg bg-white"></canvas>
      <button id="clearIssuerSignature" class="text-xs text-red-600 mt-2 hover:underline">Clear</button>
    </div>
  </section>

  <div class="text-center mb-10 no-print">
    <button id="generateBtn" class="btn-generate">Generate Invoice</button>
  </div>

  <section id="invoicePreview" class="hidden">
    <div class="invoice-header">
      <img src="images/logo.jpg" alt="Logo" class="invoice-logo">
      <div class="flex-1 text-center">
        <h1 class="invoice-title">EL KING'S INTERIOR</h1>
        <p class="invoice-subtitle">INVOICE</p>
      </div>
      <div class="w-20"></div>
    </div>
    <div class="invoice-body">
      <div class="invoice-contact"><p>No. 123, FHA, Lugbe, Abuja | +234-810 148 6536 | info@elkingsinterior.com</p></div>
      <div class="invoice-info">
        <div><p><strong>Invoice No:</strong> <span id="prevInvoiceNo" class="font-mono"></span></p><p><strong>Issue Date:</strong> <span id="prevInvoiceDate"></span></p><p><strong>Due Date:</strong> <span id="prevDueDate"></span></p></div>
        <div><p><strong>Bill To:</strong> <span id="prevCustomerName"></span></p><p><strong>Phone:</strong> <span id="prevCustomerPhone"></span></p><p><strong>Address:</strong> <span id="prevCustomerAddress"></span></p></div>
      </div>
      <table class="invoice-table">
        <thead><tr><th>NO.</th><th>DESCRIPTION</th><th class="text-center">QTY</th><th class="text-right">UNIT PRICE</th><th class="text-right">TOTAL</th></tr></thead>
        <tbody id="prevTableBody"></tbody>
      </table>
      <div class="text-right space-y-1">
        <p class="invoice-total">Subtotal: <span id="prevSubtotal"></span></p>
        <p class="invoice-tax">+ Tax (<span id="prevTaxRate">0</span>%): <span id="prevTaxAmount"></span></p>
        <p class="invoice-discount">- Discount (<span id="prevDiscountRate">0</span>%): <span id="prevDiscountAmount"></span></p>
        <p class="invoice-grand-total">AMOUNT DUE: <span id="prevGrandTotal"></span></p>
      </div>
      <div class="qr-container"><p class="text-xs text-gray-600">Scan to Verify Invoice</p><img id="qrCodeImg" src="" alt="QR Code"></div>
      <div class="invoice-notes">
        <p><strong>Payment Terms:</strong> Payment is due within 7 days of invoice date.</p>
        <p><strong>Bank Details:</strong> Fidelity Bank | Acc: 5601381917 | King's space design</p>
      </div>
      <div class="signature-area">
        <div><p>Received by:</p><div class="signature-line"></div><p class="mt-1">Customer Signature</p></div>
        <div class="text-right"><p>Issued by:</p><p class="font-bold">Philip Odeh Anyebe</p><img id="issuerSignatureImg" src="" alt="Signature" class="hidden max-h-10 mt-1"></div>
      </div>
      <div class="footer"><p>www.elkingsinterior.com</p></div>
    </div>
  </section>

  <div id="actionButtons" class="hidden flex justify-center gap-6 mt-10 no-print">
    <button id="printBtn" class="btn-gold">Print / Save as PDF</button>
    <button id="emailBtn" class="btn-gold">Email Invoice</button>
  </div>
</div>

<script>
  const getNextInvoiceNo = () => {
    const year = new Date().getFullYear();
    const key = `lastInvoiceNo_${year}`;
    const last = parseInt(localStorage.getItem(key) || '0');
    const next = last + 1;
    localStorage.setItem(key, next);
    return `INV-${year}-${String(next).padStart(4, '0')}`;
  };

  document.getElementById('invoiceDate').valueAsDate = new Date();
  document.getElementById('invoiceNo').value = getNextInvoiceNo();

  const items = [];
  let serialNo = 1;
  const formatCurrency = n => '₦ ' + parseFloat(n).toLocaleString('en-NG', { minimumFractionDigits: 2 });

  const canvas = document.getElementById('issuerSignatureCanvas');
  const ctx = canvas.getContext('2d');
  let drawing = false;

  const startDraw = (e) => {
    drawing = true;
    const r = canvas.getBoundingClientRect();
    const clientX = e.clientX || (e.touches && e.touches[0].clientX);
    const clientY = e.clientY || (e.touches && e.touches[0].clientY);
    ctx.beginPath();
    ctx.moveTo(clientX - r.left, clientY - r.top);
  };

  const draw = (e) => {
    if (!drawing) return;
    const r = canvas.getBoundingClientRect();
    const clientX = e.clientX || (e.touches && e.touches[0].clientX);
    const clientY = e.clientY || (e.touches && e.touches[0].clientY);
    ctx.lineTo(clientX - r.left, clientY - r.top);
    ctx.strokeStyle = '#000';
    ctx.lineWidth = 2.5;
    ctx.lineCap = 'round';
    ctx.stroke();
  };

  const stopDraw = () => { drawing = false; };

  canvas.addEventListener('touchstart', (e) => { e.preventDefault(); startDraw(e); }, { passive: false });
  canvas.addEventListener('touchmove', (e) => { e.preventDefault(); draw(e); }, { passive: false });
  canvas.addEventListener('touchend', stopDraw);

  canvas.addEventListener('mousedown', startDraw);
  canvas.addEventListener('mousemove', draw);
  canvas.addEventListener('mouseup', stopDraw);
  canvas.addEventListener('mouseout', stopDraw);

  document.getElementById('clearIssuerSignature').onclick = () => ctx.clearRect(0,0,canvas.width,canvas.height);

  document.getElementById('addItemBtn').onclick = () => {
    const desc = document.getElementById('description').value.trim();
    const qty = +document.getElementById('quantity').value;
    const price = +document.getElementById('price').value;
    if (!desc || qty <= 0 || price <= 0) return alert('Fill all fields.');
    items.push({ serialNo: serialNo++, desc, qty, price, total: qty * price });
    updateCalculations(); clearInputs();
  };

  const clearInputs = () => { ['description','quantity','price'].forEach(id => document.getElementById(id).value = ''); };

  const updateCalculations = () => {
    const subtotal = items.reduce((s, it) => s + it.total, 0);
    const taxRate = +document.getElementById('taxPercent').value || 0;
    const discountRate = +document.getElementById('discountPercent').value || 0;
    const taxAmount = subtotal * (taxRate / 100);
    const discountAmount = subtotal * (discountRate / 100);
    const grandTotal = subtotal + taxAmount - discountAmount;

    const tbody = document.getElementById('itemsTableBody'); tbody.innerHTML = '';
    items.forEach((it, i) => {
      const tr = document.createElement('tr');
      tr.innerHTML = `<td class="px-4 py-2">${it.serialNo}</td><td class="px-4 py-2">${it.desc}</td><td class="px-4 py-2 text-center">${it.qty}</td><td class="px-4 py-2 text-right">${formatCurrency(it.price)}</td><td class="px-4 py-2 text-right font-medium">${formatCurrency(it.total)}</td><td class="px-4 py-2 text-center"><button onclick="removeItem(${i})" class="text-red-600 text-xs hover:underline">Remove</button></td>`;
      tbody.appendChild(tr);
    });

    document.getElementById('subtotal').textContent = formatCurrency(subtotal);
    document.getElementById('taxRate').textContent = taxRate;
    document.getElementById('taxAmount').textContent = formatCurrency(taxAmount);
    document.getElementById('discountRate').textContent = discountRate;
    document.getElementById('discountAmount').textContent = formatCurrency(discountAmount);
    document.getElementById('grandTotal').textContent = formatCurrency(grandTotal);
  };

  window.removeItem = idx => { items.splice(idx,1); items.forEach((it,i)=>it.serialNo=i+1); serialNo=items.length+1; updateCalculations(); };
  ['taxPercent', 'discountPercent'].forEach(id => document.getElementById(id).addEventListener('input', updateCalculations));

  document.getElementById('generateBtn').onclick = () => {
    if (items.length === 0) return alert('Add at least one item.');
    if (!document.getElementById('customerName').value.trim()) return alert('Customer name required.');
    const hasSig = canvas.getContext('2d').getImageData(0,0,canvas.width,canvas.height).data.some(c=>c!==0);
    if (!hasSig) return alert('Please sign as Philip Odeh Anyebe.');

    const name = document.getElementById('customerName').value.trim();
    const phone = document.getElementById('customerPhone').value.trim() || 'N/A';
    const address = document.getElementById('customerAddress').value.trim() || 'N/A';
    const invoiceDate = new Date(document.getElementById('invoiceDate').value);
    const dueDate = document.getElementById('dueDate').value ? new Date(document.getElementById('dueDate').value) : null;
    const invoiceNo = document.getElementById('invoiceNo').value;

    const fmtInvoiceDate = invoiceDate.toLocaleDateString('en-GB', {day:'numeric', month:'long', year:'numeric'});
    const fmtDueDate = dueDate ? dueDate.toLocaleDateString('en-GB', {day:'numeric', month:'long', year:'numeric'}) : 'N/A';

    const subtotal = items.reduce((s,it)=>s+it.total,0);
    const taxRate = +document.getElementById('taxPercent').value || 0;
    const discountRate = +document.getElementById('discountPercent').value || 0;
    const taxAmount = subtotal * (taxRate / 100);
    const discountAmount = subtotal * (discountRate / 100);
    const grandTotal = subtotal + taxAmount - discountAmount;

    const qrData = { invoice_no: invoiceNo, date: fmtInvoiceDate, due_date: fmtDueDate, customer: name, total: formatCurrency(grandTotal), issuer: "Philip Odeh Anyebe" };
    document.getElementById('qrCodeImg').src = `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(JSON.stringify(qrData,null,2))}`;

    document.getElementById('prevInvoiceNo').textContent = invoiceNo;
    document.getElementById('prevInvoiceDate').textContent = fmtInvoiceDate;
    document.getElementById('prevDueDate').textContent = fmtDueDate;
    document.getElementById('prevCustomerName').textContent = name;
    document.getElementById('prevCustomerPhone').textContent = phone;
    document.getElementById('prevCustomerAddress').textContent = address;

    const tbody = document.getElementById('prevTableBody'); tbody.innerHTML = '';
    items.forEach(it => {
      const tr = document.createElement('tr');
      tr.innerHTML = `<td>${it.serialNo}</td><td>${it.desc}</td><td class="text-center">${it.qty}</td><td class="text-right">${formatCurrency(it.price)}</td><td class="text-right font-medium">${formatCurrency(it.total)}</td>`;
      tbody.appendChild(tr);
    });

    document.getElementById('prevSubtotal').textContent = formatCurrency(subtotal);
    document.getElementById('prevTaxRate').textContent = taxRate;
    document.getElementById('prevTaxAmount').textContent = formatCurrency(taxAmount);
    document.getElementById('prevDiscountRate').textContent = discountRate;
    document.getElementById('prevDiscountAmount').textContent = formatCurrency(discountAmount);
    document.getElementById('prevGrandTotal').textContent = formatCurrency(grandTotal);

    const sigImg = document.getElementById('issuerSignatureImg');
    sigImg.src = canvas.toDataURL();
    sigImg.classList.remove('hidden');

    document.getElementById('invoicePreview').classList.remove('hidden');
    document.getElementById('actionButtons').classList.remove('hidden');
    document.getElementById('generateBtn').classList.add('hidden');
  };

  document.getElementById('printBtn').onclick = () => window.print();
  document.getElementById('emailBtn').onclick = () => {
    const subject = `Invoice ${document.getElementById('prevInvoiceNo').textContent}`;
    const body = document.getElementById('invoicePreview').innerHTML;
    window.location.href = `mailto:?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(`<html><body style="font-family:Montserrat,sans-serif;">${body}</body></html>`)}`;
  };

  updateCalculations();
</script>
</body>
</html>
